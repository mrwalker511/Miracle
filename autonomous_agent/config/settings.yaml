# Main system configuration
system:
  name: "Autonomous Coding Agent"
  version: "0.1.0"
  environment: "development"  # development, production

orchestrator:
  max_iterations: 15
  circuit_breaker:
    warning_threshold: 12
    hard_stop: 15
  checkpoint_interval: 5  # Save state every N iterations
  timeout_per_iteration: 600  # 10 minutes

# Context hygiene settings for token management
context_hygiene:
  max_tokens: 128000           # Model context limit
  warning_threshold: 0.50      # 50% - start monitoring
  critical_threshold: 0.75     # 75% - consider compaction
  overflow_threshold: 0.90     # 90% - force compaction
  min_preserved_tokens: 4000   # Always keep for response

# Execution hooks for safety guardrails
execution_hooks:
  enabled: true
  hooks:
    block_dangerous_commands:
      enabled: true
    protect_sensitive_files:
      enabled: true
    auto_format_code:
      enabled: true
    token_budget:
      enabled: true
      max_tokens: 50000
    iteration_guard:
      enabled: true
      max_same_error: 3

# Optional review phases
review_phases:
  code_review:
    enabled: false             # Enable with --enable-review flag
    block_on_critical: true    # Block progress on critical issues
  security_audit:
    enabled: false             # Enable with --enable-audit flag
    block_on_critical: true    # Block progress on critical vulnerabilities

sandbox:
  engine: "docker"
  workspace_root: "./sandbox/workspace"
  resource_limits:
    cpu_count: 1
    memory_mb: 1024
    execution_timeout: 300  # 5 minutes
    disk_quota_mb: 500
  network:
    enabled: false  # Require approval
    allowed_domains: []  # Populated after approval
  docker:
    # Optional: override the Docker images used for running tests.
    # For Python you may want an image that already has pytest installed.
    python_image: "python:3.11-slim"
    node_image: "node:20-slim"

safety:
  ast_scan: true
  bandit_scan: true
  block_operations:
    - "eval"
    - "exec"
    - "compile"
    - "__import__"
    - "open"  # Outside sandbox
  require_approval:
    - "network_request"
    - "subprocess"
    - "file_write_outside_sandbox"
    - "dependency_install"

dependencies:
  mode: "allowlist"  # allowlist, auto (future), manual
  allowlist_file: "config/allowed_deps.json"
  auto_approve: false

logging:
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR
  format: "json"  # json, text
  outputs:
    - "console"
    - "file"
  file_path: "logs/agent.log"
  rotation: "100MB"

metrics:
  enabled: true
  collect:
    - "iteration_duration"
    - "token_usage"
    - "test_pass_rate"
    - "error_types"
    - "pattern_matches"
  export_interval: 60  # seconds
